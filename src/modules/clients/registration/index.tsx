import { observer } from 'mobx-react-lite';
import { useState, type ChangeEvent, type FormEvent, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

import { useCustomerStore } from 'Common/stores/rootStore.tsx';

const Registration = observer(() => {
  const [id, setId] = useState('');
  const customerStore = useCustomerStore();
  const navigate = useNavigate();
  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    void customerStore.loadCustomerById(id);
  };

  const handleIdChange = (event: ChangeEvent<HTMLInputElement>) => {
    setId(event.target.value);
    if (customerStore.error) {
      customerStore.clearError();
    }

    if (customerStore.customer) {
      customerStore.clearCustomer();
    }
  };

  const isLoading = customerStore.isLoading;
  const error = customerStore.error;
  const customer = customerStore.customer;
  const isSubmitDisabled = isLoading || !id.trim();

  useEffect(() => {
    if (customer) {
      navigate('/client/registration-form');
    }
  }, [customer, navigate]);

  return (
    <div className="flex-1 flex items-center justify-center px-4 py-8">
      <div className="w-full max-w-[553px] p-6 md:p-9 flex flex-col items-center gap-7">
        <div className="flex flex-col items-center gap-4.5">
          <svg
            className="w-[133px] h-[127px]"
            viewBox="0 0 133 127"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M132.915 47.2007C132.915 47.2322 132.915 47.2795 132.915 47.3268C132.805 47.6894 132.71 48.0362 132.6 48.3988C129.683 58.2356 126.625 68.025 123.472 77.783C123.33 78.2086 123.173 78.6343 122.968 79.2018C122.857 78.8077 122.779 78.5397 122.731 78.2874C122.085 75.3553 120.95 72.6282 119.374 70.0744C117.34 66.7954 114.739 64.0052 111.76 61.5618C107.724 58.2513 103.247 55.7133 98.4232 53.7586C96.6576 53.0492 94.8605 52.4659 93.0634 51.8196C92.7797 51.725 92.4801 51.5989 92.1649 51.725C92.1964 51.8038 92.1964 51.8511 92.2279 51.8669C92.4013 51.9615 92.5747 52.056 92.7639 52.1349C94.5925 52.9861 96.3896 53.9004 98.1237 54.9724C103.373 58.204 107.882 62.2554 111.239 67.4575C116.252 75.1819 118.333 83.726 117.955 92.885C117.781 96.9521 116.993 100.909 115.701 104.755C113.509 111.282 111.287 117.808 109.08 124.334C109.001 124.571 108.891 124.823 108.827 125.059C108.733 125.39 108.559 125.548 108.197 125.532C107.708 125.517 107.204 125.564 106.715 125.564C103.389 125.611 100.063 125.658 96.7207 125.722C94.0093 125.769 91.2821 125.832 88.5707 125.879C84.204 125.958 79.8531 126.037 75.4865 126.116C75.3604 126.116 75.25 126.068 75.1081 126.053C75.1554 125.974 75.1554 125.926 75.187 125.911C75.2815 125.848 75.3761 125.785 75.4865 125.722C79.6797 123.357 82.9429 120.046 85.4494 115.964C88.949 110.273 90.7461 104.014 91.5501 97.425C91.7708 95.5806 91.8811 93.7205 91.9757 91.8603C92.0387 90.7095 92.0072 89.5588 92.0072 88.408C92.0072 88.2188 92.0387 87.9823 91.7708 87.7932C91.7235 88.0454 91.6762 88.2346 91.6446 88.4237C91.3294 91.3243 90.7776 94.1776 89.9579 96.9836C87.6563 104.976 83.4 111.707 76.9525 117.004C72.8224 120.409 68.1562 122.837 63.0959 124.539C59.5648 125.722 55.9548 126.462 52.2503 126.762C49.6019 126.967 46.9378 126.951 44.2894 126.904C38.4882 126.825 32.6713 126.746 26.8701 126.652C26.7282 126.652 26.6021 126.652 26.4287 126.652C22.7557 116.09 19.0827 105.544 15.4254 94.9816C15.52 94.9816 15.5673 94.9501 15.5988 94.9816C15.7249 95.0762 15.851 95.1708 15.9614 95.2811C18.5152 97.6142 21.4158 99.3482 24.6474 100.562C27.9894 101.807 31.4575 102.454 35.0201 102.69C37.9838 102.895 40.9317 102.738 43.8638 102.406C46.8905 102.06 49.8856 101.429 52.8178 100.594C53.9055 100.278 54.9774 99.9473 56.0494 99.6005C56.3962 99.4901 56.7588 99.3955 57.0583 99.0014C56.475 99.096 56.0021 99.1748 55.5134 99.2694C52.7705 99.7896 49.996 100.089 47.19 100.136C44.983 100.168 42.7918 100.01 40.6164 99.7108C37.905 99.3482 35.2408 98.765 32.6555 97.8191C26.145 95.4388 20.6118 91.6081 15.9614 86.4848C11.7839 81.8817 8.78874 76.5692 6.7867 70.7207C5.65169 67.4102 4.65855 64.0367 3.61812 60.6948C2.46735 57.006 1.33233 53.3172 0.197322 49.6284C0.00815292 49.0293 0.023917 49.0136 0.512603 48.651C9.10402 42.2035 17.6954 35.756 26.3026 29.3243C26.4603 29.2139 26.6179 29.1036 26.8228 28.9617C26.8544 29.4031 26.6494 29.7026 26.5075 30.0179C25.2149 32.9658 24.5055 36.0713 24.3479 39.2872C24.1745 42.8025 24.6159 46.2549 25.4514 49.6441C26.5233 53.9004 28.2258 57.8887 30.3224 61.7352C31.6939 64.2574 33.2546 66.6693 34.9886 68.9709C35.1305 69.1443 35.2724 69.3177 35.4773 69.5542C35.5561 69.1285 35.3985 68.8921 35.2724 68.6556C32.1195 63.0278 30.149 57.0375 29.5658 50.6057C29.2663 47.2638 29.4081 43.9533 29.9914 40.6586C30.9372 35.3304 32.892 30.3805 35.7138 25.7616C38.9296 20.4649 43.1386 16.0824 48.1674 12.504C53.8267 8.48417 59.5017 4.51163 65.1768 0.507556C65.3975 0.349916 65.6339 0.208039 65.8704 0.0661621C66.0438 0.192275 66.1857 0.286859 66.3433 0.381443C70.5996 3.36085 74.8559 6.3245 79.0965 9.33543C83.605 12.5198 88.1135 15.7514 92.6063 18.9515C92.7639 19.0619 92.9215 19.188 93.0792 19.3141C92.827 19.3771 92.622 19.3771 92.4329 19.3614C89.3746 18.9673 86.3479 19.2037 83.3527 19.9446C78.9073 21.0481 74.8875 23.0344 71.1671 25.667C65.8862 29.4031 61.488 34.022 57.7519 39.2872C57.61 39.4763 57.4839 39.6813 57.3736 39.8862C57.342 39.965 57.3893 40.0911 57.4366 40.3276C57.6258 40.0911 57.7362 39.9808 57.8307 39.8547C57.9411 39.7128 58.0514 39.5709 58.1775 39.4448C62.4181 34.9205 67.3049 31.2948 72.9642 28.7568C77.1575 26.8808 81.5714 25.7773 86.1588 25.5251C88.618 25.3832 91.0771 25.4463 93.5206 25.6985C96.563 26.0138 99.5424 26.6444 102.459 27.5745C107.551 29.2139 112.154 31.7362 116.426 34.9205C121.88 39.0034 127.398 43.1021 132.915 47.2007Z"
              fill="#B52F27"
            />
          </svg>
          <div className="text-[#232323] font-medium text-xl leading-[100%] tracking-[0.2px]">
            ФинансКредитБанк
          </div>
        </div>

        <form onSubmit={handleSubmit} className="w-full max-w-[452px] flex flex-col gap-10">
          <div className="flex flex-col items-center gap-2">
            <h1 className="text-[#1A1A1A] text-center font-semibold text-2xl leading-[100%]">
              Регистрация клиента в МП
            </h1>
          </div>

          <div className="flex flex-col gap-2">
            <label htmlFor="id" className="text-[#23262F] text-sm font-medium leading-[100%]">
              ABC ID
            </label>
            <div className="relative">
              <input
                id="id"
                type="text"
                value={id}
                onChange={handleIdChange}
                placeholder="ID"
                className="w-full h-12 px-4 rounded-xl border border-[#D7D7D7] bg-[#FCFCFC] text-[#232323] text-base leading-[100%] placeholder:text-[#232323] focus:outline-none focus:ring-2 focus:ring-[#B50000] focus:border-transparent"
              />
            </div>
          </div>

          <button
            type="submit"
            disabled={isSubmitDisabled}
            className="w-full h-12 flex items-center justify-center gap-2 rounded-xl bg-[#B50000] text-white text-sm font-medium leading-[100%] hover:bg-[#9B0000] transition-colors focus:outline-none focus:ring-2 focus:ring-[#B50000] focus:ring-offset-2 cursor-pointer"
          >
            Подтвердить
          </button>
          <div className="flex flex-col gap-3 text-sm text-[#232323]">
            {isLoading && <div>Загрузка данных клиента...</div>}
            {error && <div className="text-[#B50000]">{error}</div>}
          </div>
        </form>
      </div>
    </div>
  );
});

export default Registration;
